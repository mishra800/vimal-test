<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Features Test - Car Seizure System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #5a67d8; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        #cameraPreview {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: #000;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }
        #cameraPreview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .photo-preview {
            max-width: 300px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üì± Mobile Features Test</h1>
    <p>Test GPS and Camera functionality for mobile app conversion</p>
    
    <div class="test-section">
        <h2>üìç GPS Test</h2>
        <button onclick="testGPS()">Test GPS Location</button>
        <div id="gpsResult"></div>
        <div id="gpsCoords"></div>
    </div>
    
    <div class="test-section">
        <h2>üì∑ Camera API Detection</h2>
        <button onclick="testCameraAPI()">Detect Camera APIs</button>
        <div id="cameraAPIResult"></div>
    </div>
    
    <div class="test-section">
        <h2>üì∏ Camera Test</h2>
        <button onclick="testCamera()">Test Camera</button>
        <button onclick="testCordovaCamera()" id="cordovaBtn" style="display:none;">Test Cordova Camera</button>
        <div id="cameraResult"></div>
        <div id="cameraPreview">
            <video id="testVideo" autoplay playsinline></video>
        </div>
        <div id="photoResult"></div>
    </div>
    
    <div class="test-section">
        <h2>üîß Environment Detection</h2>
        <button onclick="detectEnvironment()">Detect Environment</button>
        <div id="envResult"></div>
    </div>

    <script>
        // Test GPS functionality with enhanced mobile support
        function testGPS() {
            const result = document.getElementById('gpsResult');
            const coords = document.getElementById('gpsCoords');
            
            result.innerHTML = 'üîÑ Testing GPS...';
            
            // Check for different geolocation APIs
            const geoAPI = getGeolocationAPI();
            
            if (!geoAPI) {
                result.innerHTML = '<span class="error">‚ùå Geolocation not supported</span>';
                return;
            }
            
            result.innerHTML = `üîÑ Testing GPS using ${geoAPI.name}...`;
            
            geoAPI.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    result.innerHTML = `<span class="success">‚úÖ GPS working with ${geoAPI.name}!</span>`;
                    coords.innerHTML = `üìç Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)} (¬±${Math.round(accuracy)}m)`;
                },
                function(error) {
                    result.innerHTML = `<span class="error">‚ùå GPS Error: ${error.message}</span>`;
                    coords.innerHTML = `<span class="info">üí° Try enabling location services and testing outdoors</span>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 30000, // Increased for mobile
                    maximumAge: 60000
                }
            );
        }
        
        // Enhanced geolocation API detection
        function getGeolocationAPI() {
            // Check for Cordova geolocation
            if (window.cordova && navigator.geolocation) {
                return {
                    name: 'Cordova Geolocation',
                    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation)
                };
            }
            
            // Check for standard web geolocation
            if (navigator.geolocation) {
                return {
                    name: 'Web Geolocation API',
                    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation)
                };
            }
            
            return null;
        }
        
        // Test camera API detection with enhanced mobile support
        function testCameraAPI() {
            const result = document.getElementById('cameraAPIResult');
            let apis = [];
            
            // Check for Cordova camera
            if (window.cordova && navigator.camera) {
                apis.push('‚úÖ Cordova Camera Plugin');
                document.getElementById('cordovaBtn').style.display = 'inline-block';
            }
            
            // Check for Cordova Media Capture
            if (window.cordova && navigator.device && navigator.device.capture) {
                apis.push('‚úÖ Cordova Media Capture');
            }
            
            // Check for web camera
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                apis.push('‚úÖ Web MediaDevices API');
            }
            
            // Check for legacy camera
            if (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
                apis.push('‚úÖ Legacy getUserMedia API');
            }
            
            if (apis.length === 0) {
                result.innerHTML = '<span class="error">‚ùå No camera APIs available</span>';
            } else {
                result.innerHTML = '<span class="success">Available APIs:</span><br>' + apis.join('<br>');
            }
        }
        
        // Test web camera
        async function testCamera() {
            const result = document.getElementById('cameraResult');
            const preview = document.getElementById('cameraPreview');
            const video = document.getElementById('testVideo');
            
            result.innerHTML = 'üîÑ Testing camera...';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                video.srcObject = stream;
                preview.style.display = 'block';
                result.innerHTML = '<span class="success">‚úÖ Web camera working!</span>';
                
                // Add capture button
                if (!document.getElementById('captureBtn')) {
                    const captureBtn = document.createElement('button');
                    captureBtn.id = 'captureBtn';
                    captureBtn.textContent = 'üì∏ Capture Photo';
                    captureBtn.onclick = captureTestPhoto;
                    result.appendChild(captureBtn);
                }
                
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Camera Error: ${error.message}</span>`;
                preview.style.display = 'none';
            }
        }
        
        // Test Cordova camera
        function testCordovaCamera() {
            const result = document.getElementById('cameraResult');
            
            if (!window.cordova || !navigator.camera) {
                result.innerHTML = '<span class="error">‚ùå Cordova camera not available</span>';
                return;
            }
            
            result.innerHTML = 'üîÑ Opening Cordova camera...';
            
            const options = {
                quality: 75,
                destinationType: Camera.DestinationType.DATA_URL,
                sourceType: Camera.PictureSourceType.CAMERA,
                encodingType: Camera.EncodingType.JPEG,
                targetWidth: 1280,
                targetHeight: 720
            };
            
            navigator.camera.getPicture(
                function(imageData) {
                    result.innerHTML = '<span class="success">‚úÖ Cordova camera working!</span>';
                    const photoResult = document.getElementById('photoResult');
                    photoResult.innerHTML = `<img src="data:image/jpeg;base64,${imageData}" class="photo-preview" alt="Captured Photo">`;
                },
                function(error) {
                    result.innerHTML = `<span class="error">‚ùå Cordova Camera Error: ${error}</span>`;
                },
                options
            );
        }
        
        // Capture photo from web camera
        function captureTestPhoto() {
            const video = document.getElementById('testVideo');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            canvas.toBlob((blob) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoResult = document.getElementById('photoResult');
                    photoResult.innerHTML = `<img src="${e.target.result}" class="photo-preview" alt="Captured Photo">`;
                };
                reader.readAsDataURL(blob);
            }, 'image/jpeg', 0.9);
        }
        
        // Enhanced environment detection
        function detectEnvironment() {
            const result = document.getElementById('envResult');
            let env = [];
            
            // Check for Cordova
            if (window.cordova) {
                env.push('üì± Cordova/PhoneGap App');
                
                // Check if device is ready
                if (document.readyState === 'complete' && window.device) {
                    env.push(`üì± Device: ${window.device.platform} ${window.device.version}`);
                }
            }
            
            // Check for React Native
            if (window.ReactNativeWebView) {
                env.push('‚öõÔ∏è React Native WebView');
            }
            
            // Check for PWA
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                env.push('üì≤ PWA (Installed)');
            }
            
            // Check for HTTPS
            if (location.protocol === 'https:') {
                env.push('üîí HTTPS Enabled');
            } else {
                env.push('‚ö†Ô∏è HTTP (Camera/GPS may not work)');
            }
            
            // Check for mobile
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                env.push('üì± Mobile Device');
            } else {
                env.push('üíª Desktop Device');
            }
            
            // Check permissions API
            if (navigator.permissions) {
                env.push('‚úÖ Permissions API Available');
            }
            
            result.innerHTML = '<strong>Environment:</strong><br>' + env.join('<br>');
        }
        
        // Auto-run environment detection
        document.addEventListener('DOMContentLoaded', function() {
            detectEnvironment();
            testCameraAPI();
        });
    </script>
</body>
</html>